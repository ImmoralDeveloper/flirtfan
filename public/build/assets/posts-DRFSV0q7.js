class g{constructor(e,{loop:n=!1,autoplay:a=!1,interval:c=5e3,itemsPerView:d=1,step:h=1}={}){var u;this.container=e,this.wrapper=e.querySelector(".slider-wrapper"),this.slides=((u=this.wrapper)==null?void 0:u.querySelectorAll(".slide"))||[],this.loop=n,this.autoplay=a,this.interval=c,this.itemsPerView=d,this.step=h,this.currentIndex=0,this.timer=null,!(!this.wrapper||this.slides.length===0)&&e.dataset.initialized!=="true"&&(e.dataset.initialized="true",this.setup(),this.attachEvents(),a&&this.startAutoplay())}setup(){this.updateTransform(),this.updateButtons(),this.wrapper.style.display="flex",this.wrapper.style.transition="transform 0.3s ease",this.wrapper.style.willChange="transform",this.slides.forEach(e=>{e.style.minWidth=`${100/this.itemsPerView}%`})}updateSlideVideos(){this.container.querySelectorAll("video").forEach(n=>{n.pause(),console.log("Pausando video",n)});const e=this.slides[this.currentIndex];if(e){const n=e.querySelector("video");n&&(n.play().catch(()=>{}),console.log("Reproduciendo video",n))}}move(e){const n=this.slides.length-this.itemsPerView;if(e==="next")this.currentIndex+=this.step,this.currentIndex>n&&(this.currentIndex=this.loop?0:n);else if(e==="prev")this.currentIndex-=this.step,this.currentIndex<0&&(this.currentIndex=this.loop?n:0);else{const a=parseInt(e,10);isNaN(a)||(this.currentIndex=Math.max(0,Math.min(a,n)))}this.updateTransform(),this.updateButtons(),this.updateSlideVideos()}updateTransform(){const e=-(100/this.itemsPerView)*this.currentIndex;this.wrapper.style.transform=`translateX(${e}%)`}updateButtons(){if(!this.loop){const e=this.container.querySelector('[data-dir="prev"]'),n=this.container.querySelector('[data-dir="next"]'),a=this.slides.length-this.itemsPerView;e&&e.classList.toggle("disabled",this.currentIndex===0),n&&n.classList.toggle("disabled",this.currentIndex>=a)}}startAutoplay(){this.timer=setInterval(()=>this.move("next"),this.interval)}stopAutoplay(){this.timer&&clearInterval(this.timer)}attachEvents(){this.enableDragging(),this.wrapper.addEventListener("touchstart",()=>{},{passive:!0})}enableDragging(){let e=!1,n=0,a=0,c,d=!1;const h=s=>{this.container.querySelectorAll("video").forEach(l=>{l.style.pointerEvents=s})},u=s=>{e=!0,n=s,a=s,this.wrapper.style.transition="none",d=!1},r=s=>{if(!e)return;a=s;const l=a-n,y=l/this.container.offsetWidth*100,b=-(100/this.itemsPerView)*this.currentIndex;this.wrapper.style.transform=`translateX(calc(${b}% + ${y}%))`,!d&&Math.abs(l)>5&&(h("none"),d=!0)},i=()=>{if(!e)return;const s=a-n,l=this.container.offsetWidth/10;Math.abs(s)<5?this.updateTransform():s>l?this.move("prev"):s<-l?this.move("next"):this.updateTransform(),e=!1,this.wrapper.style.transition="transform 0.3s ease",d&&(h("auto"),d=!1)},t=s=>u(s.clientX),f=s=>{e&&(cancelAnimationFrame(c),c=requestAnimationFrame(()=>r(s.clientX)))},p=i,o=s=>u(s.touches[0].clientX),_=s=>{e&&(cancelAnimationFrame(c),c=requestAnimationFrame(()=>r(s.touches[0].clientX)))},m=i;this.wrapper.addEventListener("mousedown",t),document.addEventListener("mousemove",f),document.addEventListener("mouseup",p),this.wrapper.addEventListener("touchstart",o,{passive:!0}),document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("touchend",m)}}document.addEventListener("DOMContentLoaded",function(){const v=document.querySelector(".posts"),e=new Map;let n=1,a=!1,c=!0;function d(r){return e.has(r)||e.set(r,new g(r,{loop:!1,autoplay:!1,interval:5e3})),e.get(r)}function h(r){r.forEach(i=>{let t=window.postComponent;const f=`<a href="/profile/${i.user.username}" class="user-avatar"><img src="${i.user.avatar_url}" alt="Avatar" onerror="this.onerror=null;this.src='/img/avatar.webp';"></a>`;t=t.replace("__USER_AVATAR__",f),t=t.replace("__PROFILE_URL__",`/${i.user.username}`),t=t.replace("__USER_NAME__",i.user.short_name),t=t.replace("__CREATED_AT__",i.created_at),t=t.replace("__CREATED_AT_HUMAN__",i.created_at_human),t=t.replace("__POST_TYPE__",i.payment_required||i.subscription_required?'<i class="icon icon-dollar"></i> Exclusive':'<i class="icon icon-globe"></i> Public');let p=i.body;p.length>200&&(p=p.substring(0,200)+'<a href="#"><b>... See more</b></a>'),t=t.replace("__POST_BODY__",p);let o="";if(i.media.length>0){const s=i.media.length;o+=`<div class="post__media-container${s>1?" slider-container":""}" data-current-index="0" data-slides-count="${s}">`,o+=`<div class="post__media-wrapper${s>1?" slider-wrapper":""}" style="grid-template-columns: repeat(${s}, 100%);">`,i.media.forEach(l=>{o+=`<div class="post__media${s>1?" slide":""}">`,l.type==="image"?o+=`<img loading="lazy" src="${l.url}" alt="Post image">`:l.type==="video"&&(o+=`<div class="custom-video-player"><video class="custom-video" preload="metadata"><source src="${l.url}" type="video/mp4">Your browser does not support the video tag.</video><div class="controls"><button type="button" class="play-pause"><i class="icon icon-play" style="--iconSizePercent:.5"></i></button><input type="range" class="progress-bar" value="0" min="0" step="1"><span class="duration">0:00</span><div class="speed-control"><button type="button" class="speed-btn"><span class="speed-label">1x</span></button><ul class="speed-menu"><li data-speed="0.5">0.5x</li><li data-speed="0.75">0.75x</li><li data-speed="1" class="active">1x</li><li data-speed="1.25">1.25x</li><li data-speed="1.5">1.5x</li><li data-speed="1.75">1.75x</li><li data-speed="2">2x</li></ul></div><div class="volume-control"><button type="button" class="volume-btn"><i class="icon icon-volume" style="--iconSizePercent:.5"></i></button><input type="range" class="volume-bar" min="0" max="1" step="0.01" value="1"></div><button type="button" class="fullscreen"><i class="icon icon-fullscreen" style="--iconSizePercent:.5"></i></button></div></div>`),o+="</div>"}),o+="</div>",s>1&&(o+='<button class="slider-btn disabled" data-dir="prev" data-action="swipeSlider"><i class="icon icon-left-angle-bracket"></i></button>',o+='<button class="slider-btn" data-dir="next" data-action="swipeSlider"><i class="icon icon-right-angle-bracket"></i></button>'),o+="</div>"}t=t.replace("__MEDIA_CONTAINER__",o),t=t.replace("__LIKE_ACTIVE__",i.has_liked?"active":""),t=t.replace("__TIP_BUTTON__",i.user.is_performer?'<button type="button" class="post__tip button"><i class="icon icon-tip"></i><span>Tip</span></button>':"");const _=document.createElement("div");_.innerHTML=t;const m=_.firstElementChild;v.appendChild(m),m.querySelector(".slider-container")&&d(m.querySelector(".slider-container")),m.querySelectorAll(".custom-video-player").forEach(s=>{window.initCustomVideoPlayer&&window.initCustomVideoPlayer(s)})})}async function u(){if(!(a||!c)){a=!0;try{const i=await(await fetch(window.postsLoadRoute,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({page:n})})).json();h(i.posts),c=i.hasMore,n++}catch(r){console.log(r)}finally{a=!1}}}u(),window.addEventListener("scroll",function(){if(!c||a)return;v.getBoundingClientRect().bottom-window.innerHeight<400&&u()}),v.addEventListener("click",function(r){const i=r.target.closest('[data-action="swipeSlider"]');if(!i)return;const t=i.closest(".slider-btn");if(!t)return;const f=t.closest(".slider-container"),p=d(f),o=t.dataset.dir;p.move(o)})});
